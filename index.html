<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Planet Transit</title>

<style>
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  margin:0;
  padding:8px;
  background:#f4f6fb;
  color:#222;
}

h2{
  text-align:center;
  margin:6px 0 10px;
  font-size:18px;
  font-weight:600;
}

.controls{
  display:flex;
  gap:8px;
  max-width:420px;
  margin:0 auto 8px;
}

.controls input{
  flex:1;
  height:36px;
  padding:6px 8px;
  font-size:14px;
  border:1px solid #ccc;
  border-radius:4px;
}

.controls button{
  width:90px;
  height:36px;
  font-size:14px;
  background:#243c8f;
  color:#fff;
  border:none;
  border-radius:4px;
  cursor:pointer;
}

#info{
  text-align:center;
  font-size:13px;
  font-weight:600;
  margin:6px 0;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  font-size:12px;
}

th,td{
  border:1px solid #ccc;
  padding:5px 6px;
  text-align:center;
  white-space:nowrap;
}

th{
  background:#243c8f;
  color:#fff;
}

.loader{
  width:16px;
  height:16px;
  border:3px solid #fff;
  border-top:3px solid transparent;
  border-radius:50%;
  animation:spin 0.8s linear infinite;
  display:inline-block;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}

button.loading{
  pointer-events:none;
  opacity:0.8;
}

.loading-row{
  font-weight:600;
  color:#555;
}

@media(max-width:480px){
  table{ font-size:13px; }
  th,td{ padding:6px; }
}
</style>
</head>

<body>

<h2>ü™ê Planet Transit</h2>

<div class="controls">
  <input type="date" id="dateInput">
  <button id="showBtn">Show</button>
</div>

<div id="info"></div>

<table>
<thead>
<tr>
  <th>Planet</th>
  <th>D.M.S</th>
  <th>Sign</th>
  <th>Star</th>
  <th>Sub</th>
  <th>S.Time</th>
</tr>
</thead>
<tbody id="tbody">
<tr><td colspan="6">Select a date</td></tr>
</tbody>
</table>

<script>
const dateInput = document.getElementById("dateInput");
const btn = document.getElementById("showBtn");
const tbody = document.getElementById("tbody");
const info = document.getElementById("info");

/* ===== SAFE DATE PARSER (NO UTC ISSUE) ===== */
function getSelectedDate(){
  const [y,m,d] = dateInput.value.split("-").map(Number);
  return new Date(y, m-1, d); // local date
}

async function loadData(){

  if(!dateInput.value){
    alert("Select date");
    return;
  }

  const dateObj = getSelectedDate();

  btn.classList.add("loading");
  btn.innerHTML = `<span class="loader"></span>`;

  tbody.innerHTML =
    `<tr><td colspan="6" class="loading-row">Loading‚Ä¶</td></tr>`;
  info.innerHTML = "";

  try{
    const selDate =
      `${String(dateObj.getDate()).padStart(2,'0')}-${String(dateObj.getMonth()+1).padStart(2,'0')}-${dateObj.getFullYear()}`;

    const res = await fetch("panchangam_2026.json");
    const data = await res.json();

    const rows = data.filter(r => r.Date === selDate);

    if(rows.length === 0){
      tbody.innerHTML =
        `<tr><td colspan="6">No data for ${selDate}</td></tr>`;
      return;
    }

    info.innerText =
      `üìÖ ${rows[0].Day} | üïâÔ∏è Ayanamsam: ${rows[0].Ayanamsam}`;

    tbody.innerHTML = "";
    rows.forEach(r=>{
      tbody.innerHTML += `
      <tr>
        <td>${r.Planet}</td>
        <td>${r["D.M.S"]}</td>
        <td>${r.Sign}</td>
        <td>${r.Star}</td>
        <td>${r.Sub}</td>
        <td>${r["S.Time"] || ""}</td>
      </tr>`;
    });

  }catch{
    tbody.innerHTML =
      `<tr><td colspan="6">Error loading data</td></tr>`;
  }finally{
    btn.classList.remove("loading");
    btn.innerHTML = "Show";
  }
}

/* ===== EVENTS ===== */
btn.onclick = loadData;
</script>

</body>
</html>
